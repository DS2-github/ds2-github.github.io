<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <tittle> Messager </tittle>
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript">
        function sendMessage() {
            let msg = { name: document.getElementById("name").value, message: document.getElementById("message").value };
            try {
                fetch("/", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json;charset=utf-8' },
                    body: JSON.stringify(msg)
                })
            } catch {
                alert("Error in send function");
            }
        }
        function loadMsg() {
            fetch("/db", { method: 'GET' })
                .then(response => {
                    return response.text();
                })
                .then(text => {
                    let tbl = document.getElementById("msgwnd");
                    let strings = text.split(";");
                    for (let str of strings) {
                        if (str !== "") {
                            let result = JSON.parse(str);
                            tbl.insertAdjacentHTML('beforeend', `<tr><td class="name">${result.name}:</td><td class="msgsss">${result.message}</td></tr>`);
                        }
                    }
                    tick();
                })
        }
        function tick() {
            setTimeout(loadMsg(), 500);
        }
    </script>
</head>


<body onload="tick();">
    <div>
        <table id="msgwnd">
            <tr>
                <td><label for="name" class="send">Name</label> <input type="text" id="name"></td>
                <td><label for="message" class="send">Message</label> <input type="text" id="message">
                    <button onclick="sendMessage();" class="send">&#8250;</button>
                </td>
            </tr>
        </table>
    </div>
</body>

</html>